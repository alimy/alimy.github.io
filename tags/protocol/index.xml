<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
      <title>Protocol on 北野 </title>
      <generator uri="https://gohugo.io">Hugo</generator>
    <link>https://alimy.github.io/tags/protocol/</link>
    <language>en</language>
    
    <copyright>&amp;copy;2018, Alimy; all rights reserved.</copyright>
    <updated>Sat, 14 Feb 2026 19:20:00 CST</updated>
    
    <item>
      <title>rpcx - 消息协议</title>
      <link>https://alimy.github.io/post/dev_202602141920/</link>
      <pubDate>Sat, 14 Feb 2026 19:20:00 CST</pubDate>
      
      <guid>https://alimy.github.io/post/dev_202602141920/</guid>
      <description>&lt;p&gt;rpcx 的 请求(request)和响应(response)使用相同的数据结构。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://alimy.github.io/images/post/20260214192000.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;一个消息由下面的项组成:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;1. Header: &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt; 字节
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2. Message ID: &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt; 字节
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;3. total size: &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt; 字节, 不包含header和它本身, uint32类型
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;4. servicePath值的长度: &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt; 字节, uint32类型
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;5. servicePath的值: UTF-8 字符串
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;6. serviceMethod值的长度: &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt; 字节, uint32类型
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;7. serviceMethod的值: UTF-8 字符串
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;8. metadata的大小: &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt; 字节, uint32类型
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;9. metadata: 格式: &lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;size&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;key1 string&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;size&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;value1 string&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;, 可以包含多个
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;10. playload的大小: &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt; 字节, uint32类型
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;11. playload的值: slice of byte
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;#4&lt;/code&gt; + &lt;code&gt;#6&lt;/code&gt; + &lt;code&gt;#8&lt;/code&gt; + &lt;code&gt;#10 + (4 + 4 + 4 + 4)&lt;/code&gt; 的字节数加起来等于 &lt;code&gt;#3&lt;/code&gt;的值。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;servicePath&lt;/code&gt;、&lt;code&gt;serviceMethod&lt;/code&gt;、&lt;code&gt;和 &lt;/code&gt;meta&lt;code&gt;中的key&lt;/code&gt; 、 &lt;code&gt;value&lt;/code&gt; 都是UTF-8 字符串。&lt;/p&gt;
&lt;p&gt;rpcx 使用 &lt;code&gt;size of an element&lt;/code&gt; + &lt;code&gt;element&lt;/code&gt; 的格式定义可变长的元素， 就像 &lt;a href=&#34;https://en.wikipedia.org/wiki/Type-length-value&#34;&gt;TLV&lt;/a&gt;， 但是 rpcx 不需要 &lt;code&gt;Type&lt;/code&gt;字段， 这是因为 元素的&lt;code&gt;Type&lt;/code&gt; 要么是 UTF-8 字符串，要么就是明确的slice。&lt;/p&gt;
&lt;p&gt;对整数使用大端 &lt;code&gt;BigEndian&lt;/code&gt; 编码 (integer type, int64, uint32 等等)&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;第一个字节是 &lt;code&gt;0x08&lt;/code&gt;, 它是一个魔数 (magic number)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;第二个字节是 &lt;code&gt;version&lt;/code&gt;. 当前的版本是 0.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;、MessageType 可以是:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0: Request&lt;/li&gt;
&lt;li&gt;1: Response&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;、Heartbeat: bool. 指示这个消息是否是heartbeat消息&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;、Oneway: bool. true的话意味着服务不需要返回response&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;、CompressType:  压缩类型&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0: don&amp;rsquo;t compress&lt;/li&gt;
&lt;li&gt;1: Gzip&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;、MessageStatusType: 指示 response 是一个错误还是正常的返回值&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0: Normal&lt;/li&gt;
&lt;li&gt;1: Error&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;、SerializeType: 编解码格式&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0: 使用原始的byte slice&lt;/li&gt;
&lt;li&gt;1: JSON&lt;/li&gt;
&lt;li&gt;2: Protobuf&lt;/li&gt;
&lt;li&gt;3: MessagePack&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;如果服务处理请求失败，它会返回error response， 它会设置 response 的 MessageStatusType为 &lt;code&gt;1&lt;/code&gt;, 并且在meta中设置错误信息， meta中的 key值是 &lt;strong&gt;rpcx_error&lt;/strong&gt;， 值是错误信息。&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Kitex TTHeader协议</title>
      <link>https://alimy.github.io/post/dev_202602141900/</link>
      <pubDate>Sat, 14 Feb 2026 19:00:00 CST</pubDate>
      
      <guid>https://alimy.github.io/post/dev_202602141900/</guid>
      <description>&lt;p&gt;参考 &lt;a href=&#34;https://github.com/apache/thrift/blob/master/doc/specs/HeaderFormat.md&#34;&gt;Thrift THeader 协议&lt;/a&gt; ，Kitex设计了 TTheader 协议。&lt;/p&gt;
&lt;h4 id=&#34;协议编码&#34;&gt;协议编码&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt; a b c d e f &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt; a b c d e f
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;+----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| 0|                          LENGTH                             |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;+----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| 0|       HEADER MAGIC          |            FLAGS              |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;+----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|                         SEQUENCE NUMBER                        |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;+----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| 0|     HEADER SIZE             | ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;+---------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  Header is of variable size:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;and starts at offset 14&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;+----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| PROTOCOL ID  |NUM TRANSFORMS . |TRANSFORM &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; ID &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;uint8&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;|
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;+----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|  TRANSFORM &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; DATA ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;+----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|         ...                              ...                   |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;+----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| INFO &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; ID &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;uint8&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;|       INFO &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;  DATA ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;+----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|         ...                              ...                   |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;+----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|                                                                |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|                              PAYLOAD                           |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|                                                                |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;+----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;其中：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;LENGTH&lt;/code&gt; 字段 32bits，包括数据包剩余部分的字节大小，不包含 &lt;code&gt;LENGTH&lt;/code&gt; 自身长度&lt;/li&gt;
&lt;li&gt;&lt;code&gt;HEADER MAGIC&lt;/code&gt; 字段 16bits，值为：0x1000，用于标识 TTHeaderTransport&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FLAGS&lt;/code&gt; 字段 16bits，为预留字段，暂未使用，默认值为 &lt;code&gt;0x0000&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SEQUENCE NUMBER&lt;/code&gt; 字段 32bits，表示数据包的 seqId，可用于多路复用，最好确保单个连接内递增&lt;/li&gt;
&lt;li&gt;&lt;code&gt;HEADER SIZE&lt;/code&gt; 字段 16bits，等于头部长度字节数 /4，头部长度计算从第 14 个字节开始计算，一直到 &lt;code&gt;PAYLOAD&lt;/code&gt; 前（备注：header 的最大长度为 64K）&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PROTOCOL ID&lt;/code&gt; 字段 uint8 编码，取值有：
&lt;ul&gt;
&lt;li&gt;ProtocolIDBinary = 0&lt;/li&gt;
&lt;li&gt;ProtocolIDCompact = 2&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;NUM TRANSFORMS&lt;/code&gt; 字段 uint8 编码，表示 &lt;code&gt;TRANSFORM&lt;/code&gt; 个数&lt;/li&gt;
&lt;li&gt;&lt;code&gt;TRANSFORM ID&lt;/code&gt; 字段 uint8 编码，具体取值参考下文&lt;/li&gt;
&lt;li&gt;&lt;code&gt;INFO ID&lt;/code&gt; 字段 uint8 编码，具体取值参考下文&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PAYLOAD&lt;/code&gt; 消息内容&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;padding-填充&#34;&gt;PADDING 填充&lt;/h2&gt;
&lt;p&gt;Header 部分长度 bytes 数必须是 4 的倍数，不足部分用 &lt;code&gt;0x00&lt;/code&gt; 填充&lt;/p&gt;
&lt;h2 id=&#34;transform-ids&#34;&gt;Transform IDs&lt;/h2&gt;
&lt;p&gt;表示压缩方式，为预留字段，暂不支持，取值有：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ZLIB_TRANSFORM = 0x01，对应的 data 为空，表示用 &lt;code&gt;zlib&lt;/code&gt; 压缩数据；&lt;/li&gt;
&lt;li&gt;SNAPPY_TRANSFORM = 0x03，对应的 data 为空，表示用 &lt;code&gt;snappy&lt;/code&gt; 压缩数据；&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;info-ids&#34;&gt;Info IDs&lt;/h2&gt;
&lt;p&gt;用于传递一些 kv 对信息，取值有：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;INFO_KEYVALUE = 0x01，对应的 data 为 key/value 对的列表, 首先是列表大小(uint16)，之后是每个key value对, key 和 value 各自都是由 uint16 的长度加上 no-trailing-null 的字符串组成，一般用于传递一些常见的 meta 信息，例如 tracingId；&lt;/li&gt;
&lt;li&gt;INFO_INTKEYVALUE = 0x10，对应的 data 为 key/value 对的列表, 首先是列表大小(uint16)，之后是每个key value对，key 为 uint16，value 由 uint16 的长度加上 no-trailing-null 的字符串组成，一般用于传递一些内部定制的 meta 信息，其中作为 request 有些 key 是必填的：
&lt;ul&gt;
&lt;li&gt;TRANSPORT_TYPE = 1（取值：framed/unframed）&lt;/li&gt;
&lt;li&gt;LOG_ID = 2&lt;/li&gt;
&lt;li&gt;FROM_SERVICE = 3&lt;/li&gt;
&lt;li&gt;FROM_CLUSTER = 4（默认 default）&lt;/li&gt;
&lt;li&gt;FROM_IDC = 5&lt;/li&gt;
&lt;li&gt;TO_SERVICE = 6&lt;/li&gt;
&lt;li&gt;TO_METHOD = 9&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ACL_TOKEN_KEYVALUE = 0x11，对应的 data 为 key/value 对，key 和 value 各自都是由 uint16 的长度加上 no-trailing-null 的字符串组成，用于传递 ACL Token；&lt;/li&gt;
&lt;/ul&gt;</description>
    </item>
    
    <item>
      <title>Thrift THeader协议</title>
      <link>https://alimy.github.io/post/dev_202602141850/</link>
      <pubDate>Sat, 14 Feb 2026 18:50:00 CST</pubDate>
      
      <guid>https://alimy.github.io/post/dev_202602141850/</guid>
      <description>&lt;p&gt;Header format for the THeader.h&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt; a b c d e f &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt; a b c d e f
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    +----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    | 0|                          LENGTH                             |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    +----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    | 0|       HEADER MAGIC          |            FLAGS              |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    +----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |                         SEQUENCE NUMBER                        |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    +----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    | 0|     Header Size&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;/32&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;        | ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    +---------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      Header is of variable size:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;and starts at offset 14&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    +----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |         PROTOCOL ID  &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;varint&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;  |   NUM TRANSFORMS &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;varint&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;     |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    +----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |      TRANSFORM &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; ID &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;varint&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;   |        TRANSFORM &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; DATA ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    +----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |         ...                              ...                   |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    +----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |        INFO &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; ID &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;varint&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;      |       INFO &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;  DATA ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    +----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |         ...                              ...                   |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    +----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |                                                                |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |                              PAYLOAD                           |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |                                                                |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    +----------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;code&gt;LENGTH&lt;/code&gt; field is 32 bits, and counts the remaining bytes in the
packet, NOT including the length field.  The header size field is 16
bits, and defines the size of the header remaining NOT including the
&lt;code&gt;HEADER MAGIC&lt;/code&gt;, &lt;code&gt;FLAGS&lt;/code&gt;, &lt;code&gt;SEQUENCE NUMBER&lt;/code&gt; and header size fields.  The
Header size field is in bytes/4.&lt;/p&gt;
&lt;p&gt;The transform ID&amp;rsquo;s are varints.  The data for each transform is
defined by the transform ID in the code - no size is given in the
header.  If a transform ID is specified from a client and the server
doesn&amp;rsquo;t know about the transform ID, an error MUST be returned as we
don&amp;rsquo;t know how to transform the data.&lt;/p&gt;
&lt;p&gt;Conversely, data in the info headers is ignorable.  This should only
be things like timestamps, debugging tracing, etc.  Using the header
size you should be able to skip this data and read the payload safely
if you don&amp;rsquo;t know the info ID.&lt;/p&gt;
&lt;p&gt;Info&amp;rsquo;s should be oldest supported to newest supported order, so that
if we read an info ID we don&amp;rsquo;t support, none of the remaining info
ID&amp;rsquo;s will be supported either, and we can safely skip to the payload.&lt;/p&gt;
&lt;p&gt;Info ID&amp;rsquo;s and transform ID&amp;rsquo;s should share the same ID space.&lt;/p&gt;
&lt;h3 id=&#34;padding&#34;&gt;PADDING:&lt;/h3&gt;
&lt;p&gt;Header will be padded out to next 4-byte boundary with &lt;code&gt;0x00&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Max frame size is &lt;code&gt;0x3FFFFFFF&lt;/code&gt;, which is slightly less than &lt;code&gt;HTTP_MAGIC&lt;/code&gt;.
This allows us to distinguish between different (older) transports.&lt;/p&gt;
&lt;h3 id=&#34;transform-ids&#34;&gt;Transform IDs:&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ZLIB_TRANSFORM 0x01 - No data &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; this.  Use zlib to &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;de&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;compress the
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          data.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    HMAC_TRANSFORM 0x02 - Variable amount of mac data.  One byte to specify
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          size. Mac data is appended at the end of the packet.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    SNAPPY_TRANSFORM  0x03  - No data &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; this.  Use snappy to &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;de&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;compress the
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          data.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;info-ids&#34;&gt;Info IDs:&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    INFO_KEYVALUE 0x01 - varint32 number of headers.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       - key/value pairs of varstrings &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;varint16 length plus
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                         no-trailing-null string&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;. Implementations MUST NOT
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                         alter either key or value in any way.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
  </channel>
</rss>
